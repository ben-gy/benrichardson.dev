<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Ben Richardson - Indie hacker, aerospace engineer, full-stack founder based in Canberra/Melbourne, Australia">
    <title>Ben Richardson</title>
    <link rel="stylesheet" href="style.css">
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <!-- Apple Touch Icon (home screen) -->
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <!-- Apple Web App -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Ben Richardson">
    <!-- Apple Splash Screens -->
    <link rel="apple-touch-startup-image" href="splash/iphone-8.png" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)">
    <link rel="apple-touch-startup-image" href="splash/iphone-12.png" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3)">
    <link rel="apple-touch-startup-image" href="splash/iphone-14-pro.png" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3)">
    <link rel="apple-touch-startup-image" href="splash/iphone-14-pro-max.png" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3)">
    <style>
        /* Disable text selection highlighting */
        ::selection {
            background: transparent;
        }
        ::-moz-selection {
            background: transparent;
        }
        /* Custom styles for interactive features */
        .apple-logo {
            display: inline-block;
            width: 16px;
            height: 16px;
            background: url('icon/apple.svg') no-repeat center;
            background-size: contain;
            cursor: pointer;
            vertical-align: middle;
        }
        .apple-menu:focus .apple-logo,
        .apple-menu:active .apple-logo {
            filter: invert(1);
        }
        .window {
            position: absolute;
            cursor: default;
            z-index: 10;
        }
        .title-bar {
            cursor: grab;
        }
        .title-bar:active {
            cursor: grabbing;
        }
        .window.collapsed .window-pane,
        .window.collapsed .separator {
            display: none;
        }
        .hidden-dialog {
            display: none;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: transparent;
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        .modal-overlay.visible {
            display: flex;
        }
        .modal-dialog {
            background: white;
            padding: 0;
        }
        .modal-contents {
            padding: 1.5rem;
            text-align: center;
        }
        .modal-contents p {
            margin: 0.5rem 0;
        }
        .alert-box {
            background: white;
        }
        .alert-contents {
            padding: 1rem;
            text-align: center;
        }
                .alert-buttons {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            margin-top: 1rem;
        }
        .calculator-window {
            width: 180px;
        }
        .calc-display {
            background: white;
            border: 1px solid black;
            padding: 0.25rem 0.5rem;
            text-align: right;
            font-family: 'ChiKareGo2', monospace;
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
        }
        .calc-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 2px;
        }
        .calc-buttons button {
            padding: 0.5rem;
            min-width: 0;
            width: 100%;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        .fade-out {
            animation: fadeOut 0.5s forwards;
        }
        .fade-in {
            animation: fadeIn 0.3s forwards;
        }
        /* Startup screen */
        #startup-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            gap: 1rem;
        }
        #startup-screen.hidden {
            display: none;
        }
        .startup-icon {
            width: 64px;
            height: 64px;
        }
        .startup-text {
            font-family: 'ChicagoFLF', 'ChiKareGo2', monospace;
            font-size: 14px;
        }
        /* Menu bar clock */
        .menu-clock {
            margin-left: auto;
            padding: 6px 10px;
            cursor: pointer;
        }
        /* Desktop grid system */
        .desktop-grid {
            position: fixed;
            top: 28px; /* Below menu bar */
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 1;
        }
        /* Desktop icons */
        .desktop-icon {
            position: absolute;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 0.5rem;
            user-select: none;
            width: 80px;
            height: 80px;
            pointer-events: auto;
            box-sizing: border-box;
        }
        .desktop-icon:hover {
            background: rgba(0,0,0,0.1);
        }
        .desktop-icon.selected {
            background: black;
            color: white;
        }
        .desktop-icon.selected img {
            filter: invert(1);
        }
        .desktop-icon.dragging {
            opacity: 0.7;
            z-index: 5;
        }
        .desktop-icon img {
            width: 48px;
            height: 48px;
            image-rendering: pixelated;
        }
        .desktop-icon span {
            font-family: 'ChicagoFLF', 'ChiKareGo2', monospace;
            font-size: 12px;
            margin-top: 4px;
            text-align: center;
            white-space: nowrap;
        }
        .trash-icon.has-items img {
            transform: scale(1.1);
        }
        /* Lunar Lander */
        .lander-output {
            font-family: 'ChiKareGo2', monospace;
            font-size: 12px;
            border: 1px solid black;
            padding: 0.5rem;
            margin: 0 0 0.5rem 0;
            height: 160px;
            overflow-y: auto;
        }
        /* Puzzle game */
        .puzzle-window {
            width: 200px;
        }
        .puzzle-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 2px;
            background: black;
            padding: 2px;
        }
        .puzzle-tile {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'ChicagoFLF', 'ChiKareGo2', monospace;
            font-size: 1.2rem;
            font-weight: bold;
            background: white;
            border: 1px solid #999;
            cursor: pointer;
        }
        .puzzle-tile:hover {
            background: #eee;
        }
        .puzzle-tile.empty {
            background: #ccc;
            border: none;
            cursor: default;
        }
        .puzzle-controls {
            display: flex;
            justify-content: center;
            margin-top: 0.5rem;
        }
        /* Note Pad */
        .notepad-window {
            width: 280px;
        }
        .notepad-content {
            position: relative;
        }
        .notepad-textarea {
            width: 100%;
            height: 150px;
            border: 1px solid black;
            font-family: 'Geneva', 'ChiKareGo2', monospace;
            font-size: 12px;
            padding: 0.5rem;
            resize: none;
            box-sizing: border-box;
        }
        .notepad-corner {
            position: absolute;
            bottom: 5px;
            left: 5px;
            cursor: pointer;
            font-size: 1.2rem;
        }
        .notepad-page-num {
            text-align: center;
            font-size: 0.8rem;
            margin-top: 0.25rem;
        }
        /* Email window */
        .email-window {
            width: 300px;
        }
        .email-window .window-pane {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .email-window textarea {
            width: 100%;
            height: 100px;
            border: 1px solid black;
            font-family: 'Geneva', 'ChiKareGo2', monospace;
            font-size: 12px;
            padding: 0.5rem;
            resize: none;
            box-sizing: border-box;
        }
        .email-window input[readonly] {
            background: #eee;
            cursor: pointer;
        }
        /* Sad Mac */
        .sad-mac-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            flex-direction: column;
            gap: 1rem;
        }
        .sad-mac-screen.visible {
            display: flex;
        }
                .sad-mac-code {
            color: #fff;
            font-family: 'ChicagoFLF', 'ChiKareGo2', monospace;
            font-size: 14px;
        }
        /* Scrolling credits */
        .credits-container {
            height: 80px;
            overflow: hidden;
            position: relative;
            border: 1px solid black;
            margin-top: 0.5rem;
        }
        .credits-scroll {
            position: absolute;
            width: 100%;
            animation: scrollCredits 12s linear infinite;
        }
        @keyframes scrollCredits {
            0% { top: 80px; }
            100% { top: -180px; }
        }
        /* Mobile responsive styles */
        @media (max-width: 480px) {
            html, body {
                margin: 0;
                padding: 0;
                overflow-x: hidden;
                width: 100%;
                background: white;
            }
            .window {
                width: calc(100% - 2rem) !important;
                left: 1rem !important;
                top: 50% !important;
                transform: translateY(-50%);
                max-width: none;
                overflow: hidden;
            }
            .window .title-bar {
                overflow: hidden;
            }
            .desktop-icon {
                display: none;
            }
            ul[role="menu-bar"] {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                width: 100%;
                box-sizing: border-box;
            }
            ul[role="menu-bar"] > [role="menu-item"],
            .menu-clock {
                padding: 12px 12px;
                font-size: 16px;
            }
            ul[role="menu-bar"] > [role="menu-item"]:first-child {
                padding-left: 16px;
            }
            .menu-clock {
                padding-right: 16px;
            }
            .calculator-window,
            .puzzle-window,
            .notepad-window,
            .email-window,
            .search-window,
            .lander-window {
                width: calc(100% - 2rem) !important;
            }
        }
    </style>
</head>
<body>
    <!-- Startup Screen -->
    <div id="startup-screen">
        <img src="icon/apple.svg" alt="Apple" class="startup-icon">
        <div class="startup-text">Welcome to Macintosh.</div>
    </div>

    <!-- Sad Mac Screen -->
    <div class="sad-mac-screen" id="sad-mac-screen" onclick="this.classList.remove('visible')">
        <img src="icon/sad-mac.svg" alt="Sad Mac" style="width: 128px; height: 160px;">
        <div class="sad-mac-code">Sad Mac</div>
        <div class="sad-mac-code">Error Code: 0F0003</div>
        <div class="sad-mac-code" style="margin-top: 2rem; font-size: 12px;">(click to dismiss)</div>
    </div>

    <!-- Desktop Grid with Icons -->
    <div class="desktop-grid" id="desktop-grid">
        <div class="desktop-icon" id="hd-icon" style="right: 10px; top: 10px;" ondblclick="showMainWindow()">
            <img src="icon/mac-hd.svg" alt="HD">
            <span>Macintosh HD</span>
        </div>
        <div class="desktop-icon" id="email-icon" style="left: 10px; top: 10px;" ondblclick="toggleEmail()">
            <img src="icon/email.svg" alt="Email">
            <span>Email</span>
        </div>
        <div class="desktop-icon" id="internet-icon" style="left: 10px; top: 90px;" ondblclick="toggleSearch()">
            <img src="icon/internet.svg" alt="Internet">
            <span>Internet</span>
        </div>
        <div class="desktop-icon trash-icon" id="trash-icon" style="right: 10px; bottom: 10px;" ondblclick="emptyTrash()">
            <img src="icon/trash.svg" alt="Trash">
            <span>Trash</span>
        </div>
    </div>

    <!-- Menu Bar -->
    <ul role="menu-bar">
        <li role="menu-item" tabindex="0" aria-haspopup="true" class="apple-menu">
            <span class="apple-logo"></span>
            <ul role="menu">
                <li role="menu-item">
                    <a href="#" onclick="showAboutMac(event)">About This Mac</a>
                </li>
                <li class="divider"></li>
                <li role="menu-item">
                    <a href="#" onclick="restartSystem(); return false;">Restart</a>
                </li>
                <li role="menu-item">
                    <a href="#" onclick="shutDown(); return false;">Shut Down</a>
                </li>
            </ul>
        </li>
        <li role="menu-item" tabindex="0" aria-haspopup="true">
            File
            <ul role="menu">
                <li role="menu-item">
                    <a href="#" onclick="showAboutBen(event)">About Ben...</a>
                </li>
                <li class="divider"></li>
                <li role="menu-item">
                    <a href="#" onclick="toggleEmail(); return false;">Email...</a>
                </li>
                <li class="divider"></li>
                <li role="menu-item">
                    <a href="#" onclick="window.print(); return false;">Print...</a>
                </li>
                <li class="divider"></li>
                <li role="menu-item">
                    <a href="#" onclick="closeAllWindows(); return false;">Close All Windows</a>
                </li>
            </ul>
        </li>
        <li role="menu-item" tabindex="0" aria-haspopup="true">
            Edit
            <ul role="menu">
                <li role="menu-item">
                    <a href="#" onclick="navigator.clipboard.writeText('hi@benrichardson.dev'); showAlert('Email copied to clipboard!'); return false;">Copy Email</a>
                </li>
                <li class="divider"></li>
                <li role="menu-item">
                    <a href="#" onclick="showFindDialog(); return false;">Find...</a>
                </li>
            </ul>
        </li>
        <li role="menu-item" tabindex="0" aria-haspopup="true">
            View
            <ul role="menu">
                <li role="menu-item">
                    <a href="https://github.com/ben-gy/benrichardson.dev" target="_blank">View Source</a>
                </li>
                <li class="divider"></li>
                <li role="menu-item">
                    <a href="#" onclick="zoomIn(); return false;">Zoom In</a>
                </li>
                <li role="menu-item">
                    <a href="#" onclick="zoomOut(); return false;">Zoom Out</a>
                </li>
                <li class="divider"></li>
                <li role="menu-item">
                    <a href="#" onclick="location.reload(); return false;">Refresh</a>
                </li>
                <li class="divider"></li>
                <li role="menu-item">
                    <a href="#" onclick="cleanUp(); return false;">Clean Up</a>
                </li>
            </ul>
        </li>
        <li role="menu-item" tabindex="0" aria-haspopup="true">
            Sites
            <ul role="menu">
                <li role="menu-item">
                    <a href="https://github.com/ben-gy" target="_blank">GitHub</a>
                </li>
                <li role="menu-item">
                    <a href="https://www.linkedin.com/in/benrichardsonco/" target="_blank">LinkedIn</a>
                </li>
            </ul>
        </li>
        <li role="menu-item" tabindex="0" aria-haspopup="true">
            Apps
            <ul role="menu">
                <li role="menu-item">
                    <a href="#" onclick="toggleCalculator(); return false;">Calculator</a>
                </li>
                <li role="menu-item">
                    <a href="#" onclick="togglePuzzle(); return false;">Puzzle</a>
                </li>
                <li role="menu-item">
                    <a href="#" onclick="toggleNotePad(); return false;">Note Pad</a>
                </li>
                <li class="divider"></li>
                <li role="menu-item">
                    <a href="#" onclick="toggleEmail(); return false;">Email</a>
                </li>
                <li role="menu-item">
                    <a href="#" onclick="toggleSearch(); return false;">Internet</a>
                </li>
                <li class="divider"></li>
                <li role="menu-item">
                    <a href="#" onclick="toggleLander(); return false;">Lunar Lander</a>
                </li>
            </ul>
        </li>
        <li class="menu-clock" id="menu-clock" onclick="showDate()"></li>
    </ul>

    <!-- Main Window -->
    <div class="window" id="main-window" style="width: 640px;">
        <div class="title-bar" id="title-bar">
            <button aria-label="Close" class="close" onclick="closeMainWindow()"></button>
            <h1 class="title">Ben Richardson</h1>
            <button aria-label="Resize" disabled class="hidden"></button>
        </div>
        <div class="separator"></div>
        <div class="window-pane">
            <p><strong>Indie hacker, aerospace engineer, full-stack founder</strong></p>
            <p>Based in Canberra/Melbourne, Australia</p>
            <p><a href="mailto:hi@benrichardson.dev">hi@benrichardson.dev</a></p>
            <section class="field-row" style="justify-content: flex-start; padding-top: 1rem;">
                <a href="https://github.com/ben-gy" target="_blank"><button class="btn">GitHub</button></a>
                <a href="https://www.linkedin.com/in/benrichardsonco/" target="_blank"><button class="btn">LinkedIn</button></a>
            </section>
        </div>
    </div>

    <!-- Calculator Window -->
    <div class="window calculator-window" id="calculator-window" style="display: none;">
        <div class="title-bar" id="calc-title-bar">
            <button aria-label="Close" class="close" onclick="toggleCalculator()"></button>
            <h1 class="title">Calculator</h1>
            <button aria-label="Resize" disabled class="hidden"></button>
        </div>
        <div class="separator"></div>
        <div class="window-pane">
            <div class="calc-display" id="calc-display">0</div>
            <div class="calc-buttons">
                <button class="btn" onclick="calcClear()">C</button>
                <button class="btn" onclick="calcInput('/')">/</button>
                <button class="btn" onclick="calcInput('*')">√ó</button>
                <button class="btn" onclick="calcBackspace()">‚å´</button>
                <button class="btn" onclick="calcInput('7')">7</button>
                <button class="btn" onclick="calcInput('8')">8</button>
                <button class="btn" onclick="calcInput('9')">9</button>
                <button class="btn" onclick="calcInput('-')">-</button>
                <button class="btn" onclick="calcInput('4')">4</button>
                <button class="btn" onclick="calcInput('5')">5</button>
                <button class="btn" onclick="calcInput('6')">6</button>
                <button class="btn" onclick="calcInput('+')">+</button>
                <button class="btn" onclick="calcInput('1')">1</button>
                <button class="btn" onclick="calcInput('2')">2</button>
                <button class="btn" onclick="calcInput('3')">3</button>
                <button class="btn btn-default" onclick="calcEquals()" style="grid-row: span 2;">=</button>
                <button class="btn" onclick="calcInput('0')" style="grid-column: span 2;">0</button>
                <button class="btn" onclick="calcInput('.')">.</button>
            </div>
        </div>
    </div>

    <!-- Puzzle Window -->
    <div class="window puzzle-window" id="puzzle-window" style="display: none;">
        <div class="title-bar" id="puzzle-title-bar">
            <button aria-label="Close" class="close" onclick="togglePuzzle()"></button>
            <h1 class="title">Puzzle</h1>
            <button aria-label="Resize" disabled class="hidden"></button>
        </div>
        <div class="separator"></div>
        <div class="window-pane">
            <div class="puzzle-grid" id="puzzle-grid"></div>
            <div class="puzzle-controls">
                <button class="btn" onclick="shufflePuzzle()">Shuffle</button>
            </div>
        </div>
    </div>

    <!-- Note Pad Window -->
    <div class="window notepad-window" id="notepad-window" style="display: none;">
        <div class="title-bar" id="notepad-title-bar">
            <button aria-label="Close" class="close" onclick="toggleNotePad()"></button>
            <h1 class="title">Note Pad</h1>
            <button aria-label="Resize" disabled class="hidden"></button>
        </div>
        <div class="separator"></div>
        <div class="window-pane">
            <div class="notepad-content">
                <textarea class="notepad-textarea" id="notepad-textarea" placeholder="Type your notes here..."></textarea>
                <div class="notepad-corner" onclick="nextNotePage()">üìÑ</div>
            </div>
            <div class="notepad-page-num">Page <span id="notepad-page-num">1</span> of <span id="notepad-total-pages">8</span></div>
        </div>
    </div>

    <!-- Email Window -->
    <div class="window email-window" id="email-window" style="display: none;">
        <div class="title-bar" id="email-title-bar">
            <button aria-label="Close" class="close" onclick="toggleEmail()"></button>
            <h1 class="title">Email</h1>
            <button aria-label="Resize" disabled class="hidden"></button>
        </div>
        <div class="separator"></div>
        <div class="window-pane">
            <section class="field-row" style="justify-content: flex-start">
                <label class="modeless-text" style="width: 60px;">To:</label>
                <input type="text" value="hi@benrichardson.dev" readonly onclick="copyEmailAddress()" style="flex: 1;" title="Click to copy">
            </section>
            <section class="field-row" style="justify-content: flex-start">
                <label class="modeless-text" style="width: 60px;">Subject:</label>
                <input type="text" id="email-subject" style="flex: 1;" placeholder="">
            </section>
            <label class="modeless-text">Message:</label>
            <textarea id="email-body" placeholder=""></textarea>
            <section class="field-row" style="justify-content: flex-end; margin-top: 0.5rem;">
                <button class="btn" onclick="toggleEmail()">Cancel</button>
                <button class="btn btn-default" onclick="sendEmail()">Send</button>
            </section>
        </div>
    </div>

    <!-- Internet Search Window -->
    <div class="window search-window" id="search-window" style="display: none; width: 300px;">
        <div class="title-bar" id="search-title-bar">
            <button aria-label="Close" class="close" onclick="toggleSearch()"></button>
            <h1 class="title">Internet Search</h1>
            <button aria-label="Resize" disabled class="hidden"></button>
        </div>
        <div class="separator"></div>
        <div class="window-pane">
            <section class="field-row" style="justify-content: flex-start">
                <label for="search-input" class="modeless-text">Search:</label>
                <input id="search-input" type="text" style="flex: 1;" placeholder="Search the web...">
            </section>
            <section class="field-row" style="justify-content: flex-end; margin-top: 0.5rem;">
                <button class="btn" onclick="toggleSearch()">Cancel</button>
                <button class="btn btn-default" onclick="searchGoogle()">Search</button>
            </section>
        </div>
    </div>

    <!-- Lunar Lander Window -->
    <div class="window" id="lander-window" style="display: none; width: 280px;">
        <div class="title-bar" id="lander-title-bar">
            <button aria-label="Close" class="close" onclick="toggleLander()"></button>
            <h1 class="title">Lunar Lander</h1>
            <button aria-label="Resize" disabled class="hidden"></button>
        </div>
        <div class="separator"></div>
        <div class="window-pane">
            <pre class="lander-output" id="lander-output"></pre>
            <section class="field-row" style="justify-content: flex-start">
                <label class="modeless-text">BURN:</label>
                <input type="number" id="lander-input" min="0" max="30" style="width: 60px;">
                <button class="btn btn-default" onclick="landerBurn()">OK</button>
            </section>
        </div>
    </div>

    <!-- About This Mac Modal -->
    <div class="modal-overlay" id="about-mac-modal">
        <div class="modal-dialog outer-border">
            <div class="inner-border">
                <div class="modal-contents">
                    <img src="icon/apple.svg" alt="Apple" style="width: 48px; height: 48px; margin-bottom: 1rem;">
                    <h2 style="margin: 0;">Ben Richardson OS</h2>
                    <p>Version 1.0</p>
                    <div class="credits-container">
                        <div class="credits-scroll">
                            <p style="font-size: 0.8rem;">Built with <a href="https://github.com/sakofchit/system.css" target="_blank">system.css</a></p>
                            <p style="font-size: 0.8rem;">Created by Ben Richardson</p>
                            <p style="font-size: 0.8rem;">system.css by @sakofchit</p>
                            <p style="font-size: 0.8rem;">Icons by Susan Kare (1984)</p>
                            <p style="font-size: 0.8rem;">Inspired by Apple Macintosh</p>
                            <p style="font-size: 0.8rem;">¬© 1984-2024</p>
                            <p style="font-size: 0.8rem;">640K ought to be enough.</p>
                        </div>
                    </div>
                    <button class="btn btn-default" onclick="hideModal('about-mac-modal')" style="margin-top: 1rem;">OK</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Find Dialog -->
    <div class="modal-overlay" id="find-modal">
        <div class="window" style="width: 300px;">
            <div class="title-bar">
                <button aria-label="Close" class="close" onclick="hideModal('find-modal')"></button>
                <h1 class="title">Find</h1>
                <button aria-label="Resize" disabled class="hidden"></button>
            </div>
            <div class="separator"></div>
            <div class="modeless-dialog">
                <section class="field-row" style="justify-content: flex-start">
                    <label for="find-input" class="modeless-text">Find:</label>
                    <input id="find-input" type="text" style="width: 100%;" placeholder="">
                </section>
                <section class="field-row" style="justify-content: flex-end; margin-top: 1rem;">
                    <button class="btn" onclick="hideModal('find-modal')">Cancel</button>
                    <button class="btn btn-default" onclick="doFind()">Find</button>
                </section>
            </div>
        </div>
    </div>

    <!-- Alert Box Modal -->
    <div class="modal-overlay" id="alert-modal">
        <div class="alert-box outer-border">
            <div class="inner-border">
                <div class="alert-contents">
                    <p class="alert-text" id="alert-text">Alert message</p>
                    <div class="alert-buttons">
                        <button class="btn btn-default" onclick="hideModal('alert-modal')">OK</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bomb Error Modal -->
    <div class="modal-overlay" id="bomb-modal">
        <div class="alert-box outer-border">
            <div class="inner-border">
                <div class="alert-contents">
                    <span class="alert-icon">üí£</span>
                    <div class="alert-text-container">
                        <p class="alert-text">Sorry, a system error occurred.</p>
                        <p style="font-size: 0.8rem; margin: 0.5rem 0;">"Ben Richardson"</p>
                        <p style="font-size: 0.7rem; margin: 0;">unimplemented trap</p>
                        <div class="alert-buttons">
                            <button class="btn" onclick="restartSystem()">Restart</button>
                            <button class="btn btn-default" onclick="hideModal('bomb-modal')">Resume</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Konami Code Success Modal -->
    <div class="modal-overlay" id="konami-modal">
        <div class="modal-dialog outer-border">
            <div class="inner-border">
                <div class="modal-contents">
                    <p style="font-size: 2rem; margin: 0;">üéâ</p>
                    <h2 style="margin: 0.5rem 0;">Secret Unlocked!</h2>
                    <p>You found the Konami Code easter egg!</p>
                    <p style="font-size: 0.8rem;">‚Üë‚Üë‚Üì‚Üì‚Üê‚Üí‚Üê‚ÜíBA</p>
                    <button class="btn btn-default" onclick="hideModal('konami-modal')" style="margin-top: 1rem;">Nice!</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Puzzle Win Modal -->
    <div class="modal-overlay" id="puzzle-win-modal">
        <div class="modal-dialog outer-border">
            <div class="inner-border">
                <div class="modal-contents">
                    <p style="font-size: 2rem; margin: 0;">üéä</p>
                    <h2 style="margin: 0.5rem 0;">You Win!</h2>
                    <p>Congratulations, you solved the puzzle!</p>
                    <button class="btn btn-default" onclick="hideModal('puzzle-win-modal')" style="margin-top: 1rem;">OK</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============ EMAIL ============
        function toggleEmail() {
            const email = document.getElementById('email-window');
            if (email.style.display === 'none') {
                email.style.display = 'block';
                email.style.left = '80px';
                email.style.top = '90px';
                document.getElementById('email-subject').value = '';
                document.getElementById('email-body').value = '';
                document.getElementById('email-subject').focus();
            } else {
                email.style.display = 'none';
            }
        }

        function copyEmailAddress() {
            navigator.clipboard.writeText('hi@benrichardson.dev');
            showAlert('Email copied to clipboard!');
        }

        function sendEmail() {
            const subject = encodeURIComponent(document.getElementById('email-subject').value);
            const body = encodeURIComponent(document.getElementById('email-body').value);
            window.location.href = 'mailto:hi@benrichardson.dev?subject=' + subject + '&body=' + body;
            toggleEmail();
        }

        // ============ INTERNET SEARCH ============
        function toggleSearch() {
            const search = document.getElementById('search-window');
            if (search.style.display === 'none') {
                search.style.display = 'block';
                search.style.left = '100px';
                search.style.top = '130px';
                document.getElementById('search-input').value = '';
                document.getElementById('search-input').focus();
            } else {
                search.style.display = 'none';
            }
        }

        function searchGoogle() {
            const query = document.getElementById('search-input').value;
            if (query.trim()) {
                window.open('https://www.google.com/search?q=' + encodeURIComponent(query), '_blank');
                toggleSearch();
            }
        }

        // ============ LUNAR LANDER GAME ============
        let landerState = null;

        function initLander() {
            landerState = {
                altitude: 120,
                velocity: 1,
                fuel: 1600,
                gameOver: false,
                message: ''
            };
        }

        function toggleLander() {
            const lander = document.getElementById('lander-window');
            if (lander.style.display === 'none') {
                lander.style.display = 'block';
                lander.style.left = '120px';
                lander.style.top = '80px';
                initLander();
                updateLanderDisplay();
                document.getElementById('lander-input').value = '';
                document.getElementById('lander-input').focus();
            } else {
                lander.style.display = 'none';
            }
        }

        function updateLanderDisplay() {
            const output = document.getElementById('lander-output');
            let text = 'LUNAR LANDER\n';
            text += '====================\n\n';
            text += 'ALTITUDE: ' + landerState.altitude.toFixed(1) + ' MI\n';
            text += 'VELOCITY: ' + landerState.velocity.toFixed(1) + ' MI/S\n';
            text += 'FUEL:     ' + landerState.fuel.toFixed(0) + '\n\n';

            if (landerState.message) {
                text += landerState.message + '\n';
            }

            if (!landerState.gameOver) {
                text += 'BURN RATE? (0-30)';
            } else {
                text += '\n[OK TO PLAY AGAIN]';
            }

            output.textContent = text;
        }

        function landerBurn() {
            if (landerState.gameOver) {
                initLander();
                updateLanderDisplay();
                document.getElementById('lander-input').value = '';
                return;
            }

            let burn = parseInt(document.getElementById('lander-input').value) || 0;
            burn = Math.max(0, Math.min(30, burn));

            if (burn > landerState.fuel) {
                burn = landerState.fuel;
            }

            const thrustAcc = (burn * 1.8) / 33000;
            const netAcc = 0.001 - thrustAcc;
            landerState.velocity += netAcc * 10;
            landerState.altitude -= landerState.velocity * 10;
            landerState.fuel -= burn;

            if (landerState.altitude <= 0) {
                landerState.altitude = 0;
                if (landerState.velocity < 2) {
                    landerState.message = '*** SAFE LANDING! ***\nFUEL LEFT: ' + landerState.fuel.toFixed(0);
                } else {
                    landerState.message = '*** CRASH! ***\nTOO FAST: ' + landerState.velocity.toFixed(1);
                }
                landerState.gameOver = true;
            } else if (landerState.fuel <= 0) {
                landerState.message = 'OUT OF FUEL!';
            } else {
                landerState.message = '';
            }

            updateLanderDisplay();
            document.getElementById('lander-input').value = '';
            document.getElementById('lander-input').focus();
        }

        // Allow Enter key to submit in Email
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('email-subject').addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    document.getElementById('email-body').focus();
                }
            });
        });

        // ============ MENU BAR CLOCK ============
        function updateClock() {
            const now = new Date();
            let hours = now.getHours();
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const ampm = hours >= 12 ? 'PM' : 'AM';
            hours = hours % 12 || 12;
            document.getElementById('menu-clock').textContent = hours + ':' + minutes + ' ' + ampm;
        }
        updateClock();
        setInterval(updateClock, 1000);

        function showDate() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const dateStr = now.toLocaleDateString('en-US', options);
            showAlert(dateStr);
        }

        // ============ STARTUP ============
        window.addEventListener('load', function() {
            setTimeout(function() {
                document.getElementById('startup-screen').classList.add('fade-out');
                setTimeout(function() {
                    document.getElementById('startup-screen').classList.add('hidden');
                    centerWindow(document.getElementById('main-window'));
                }, 500);
            }, 1200);
        });

        // ============ WINDOW DRAGGING ============
        function makeDraggable(windowEl, handleEl) {
            let isDragging = false;
            let startX, startY, initialX, initialY;

            function startDrag(clientX, clientY) {
                isDragging = true;
                startX = clientX;
                startY = clientY;
                const rect = windowEl.getBoundingClientRect();
                initialX = rect.left;
                initialY = rect.top;
                windowEl.style.margin = '0';
                windowEl.style.left = initialX + 'px';
                windowEl.style.top = initialY + 'px';
            }

            function moveDrag(clientX, clientY) {
                if (!isDragging) return;
                const dx = clientX - startX;
                const dy = clientY - startY;
                windowEl.style.left = (initialX + dx) + 'px';
                windowEl.style.top = (initialY + dy) + 'px';
            }

            function endDrag() {
                isDragging = false;
            }

            // Mouse events
            handleEl.addEventListener('mousedown', function(e) {
                if (e.target.classList.contains('close') || e.target.classList.contains('resize')) return;
                startDrag(e.clientX, e.clientY);
            });

            document.addEventListener('mousemove', function(e) {
                moveDrag(e.clientX, e.clientY);
            });

            document.addEventListener('mouseup', endDrag);

            // Touch events
            handleEl.addEventListener('touchstart', function(e) {
                if (e.target.classList.contains('close') || e.target.classList.contains('resize')) return;
                const touch = e.touches[0];
                startDrag(touch.clientX, touch.clientY);
            }, { passive: true });

            document.addEventListener('touchmove', function(e) {
                if (!isDragging) return;
                e.preventDefault();
                const touch = e.touches[0];
                moveDrag(touch.clientX, touch.clientY);
            }, { passive: false });

            document.addEventListener('touchend', endDrag);

            // Double-click to collapse/expand (window shade)
            handleEl.addEventListener('dblclick', function(e) {
                if (e.target.classList.contains('close') || e.target.classList.contains('resize')) return;
                windowEl.classList.toggle('collapsed');
            });
        }

        // Initialize draggable windows
        makeDraggable(document.getElementById('main-window'), document.getElementById('title-bar'));
        makeDraggable(document.getElementById('calculator-window'), document.getElementById('calc-title-bar'));
        makeDraggable(document.getElementById('puzzle-window'), document.getElementById('puzzle-title-bar'));
        makeDraggable(document.getElementById('notepad-window'), document.getElementById('notepad-title-bar'));
        makeDraggable(document.getElementById('email-window'), document.getElementById('email-title-bar'));
        makeDraggable(document.getElementById('search-window'), document.getElementById('search-title-bar'));
        makeDraggable(document.getElementById('lander-window'), document.getElementById('lander-title-bar'));

        // Enter key support for search
        document.getElementById('search-input').addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                searchGoogle();
            }
        });

        // Enter key support for lander
        document.getElementById('lander-input').addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                landerBurn();
            }
        });

        // ============ WINDOW FUNCTIONS ============
        function centerWindow(windowEl) {
            const rect = windowEl.getBoundingClientRect();
            windowEl.style.margin = '0';
            windowEl.style.left = ((window.innerWidth - rect.width) / 2) + 'px';
            windowEl.style.top = (60 + (window.innerHeight - 60 - rect.height) / 3) + 'px';
        }

        let trashHasItems = false;

        function closeMainWindow() {
            const win = document.getElementById('main-window');
            win.style.display = 'none';
            trashHasItems = true;
            document.getElementById('trash-icon').classList.add('has-items');
        }

        function closeAllWindows() {
            const windows = ['main-window', 'calculator-window', 'puzzle-window', 'notepad-window', 'email-window', 'search-window', 'lander-window'];
            windows.forEach(function(id) {
                document.getElementById(id).style.display = 'none';
            });
            trashHasItems = true;
            document.getElementById('trash-icon').classList.add('has-items');
        }

        function showMainWindow() {
            const win = document.getElementById('main-window');
            win.style.display = 'block';
            win.classList.remove('collapsed');
            centerWindow(win);
        }

        function showAboutBen(e) {
            e.preventDefault();
            showMainWindow();
        }

        function emptyTrash() {
            if (trashHasItems) {
                showMainWindow();
                trashHasItems = false;
                document.getElementById('trash-icon').classList.remove('has-items');
            } else {
                showAlert('The Trash is already empty.');
            }
        }

        // ============ MODAL FUNCTIONS ============
        function showModal(id) {
            document.getElementById(id).classList.add('visible');
        }

        function hideModal(id) {
            document.getElementById(id).classList.remove('visible');
        }

        function showAlert(message) {
            document.getElementById('alert-text').textContent = message;
            showModal('alert-modal');
        }

        function showAboutMac(e) {
            e.preventDefault();
            e.stopPropagation();
            showModal('about-mac-modal');
        }

        function showFindDialog() {
            showModal('find-modal');
            document.getElementById('find-input').focus();
        }

        function doFind() {
            const query = document.getElementById('find-input').value;
            if (query) {
                window.find(query);
            }
            hideModal('find-modal');
        }

        // ============ ZOOM FUNCTIONS ============
        let currentZoom = 1;
        function applyZoom() {
            document.querySelectorAll('.window').forEach(function(w) {
                w.style.transform = 'scale(' + currentZoom + ')';
            });
        }
        function zoomIn() {
            currentZoom = Math.min(currentZoom + 0.1, 2);
            applyZoom();
        }
        function zoomOut() {
            currentZoom = Math.max(currentZoom - 0.1, 0.5);
            applyZoom();
        }

        // ============ SPECIAL MENU FUNCTIONS ============
        function cleanUp() {
            // Clean up windows
            const windows = ['main-window', 'calculator-window', 'puzzle-window', 'notepad-window', 'email-window', 'search-window', 'lander-window'];
            let offset = 0;
            windows.forEach(function(id) {
                const win = document.getElementById(id);
                if (win.style.display !== 'none') {
                    win.style.transition = 'all 0.3s ease';
                    centerWindow(win);
                    win.style.top = (parseInt(win.style.top) + offset) + 'px';
                    offset += 30;
                    setTimeout(function() {
                        win.style.transition = '';
                    }, 300);
                }
            });

            // Reset desktop icons to original positions
            const iconPositions = {
                'hd-icon': { right: '10px', top: '10px', left: '', bottom: '' },
                'email-icon': { left: '10px', top: '10px', right: '', bottom: '' },
                'internet-icon': { left: '10px', top: '90px', right: '', bottom: '' },
                'trash-icon': { right: '10px', bottom: '10px', left: '', top: '' }
            };
            Object.keys(iconPositions).forEach(function(id) {
                const icon = document.getElementById(id);
                if (icon) {
                    icon.style.transition = 'all 0.3s ease';
                    const pos = iconPositions[id];
                    icon.style.left = pos.left;
                    icon.style.right = pos.right;
                    icon.style.top = pos.top;
                    icon.style.bottom = pos.bottom;
                    setTimeout(function() {
                        icon.style.transition = '';
                    }, 300);
                }
            });
        }

        function restartSystem() {
            hideModal('bomb-modal');
            document.body.classList.add('fade-out');
            setTimeout(function() {
                location.reload();
            }, 500);
        }

        function shutDown() {
            const shutdownScreen = document.createElement('div');
            shutdownScreen.id = 'shutdown-screen';
            shutdownScreen.style.cssText = 'background:black;color:white;font-family:Chicago,ChiKareGo2,monospace;padding:2rem;text-align:center;position:fixed;top:0;left:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:2rem;z-index:10001;cursor:pointer;';
            shutdownScreen.innerHTML = '<div>It is now safe to turn off<br>your computer.</div><div style="font-size:12px;">(click to restart)</div>';
            shutdownScreen.onclick = function() { location.reload(); };
            document.body.appendChild(shutdownScreen);
        }

        // ============ CALCULATOR ============
        let calcValue = '0';

        function toggleCalculator() {
            const calc = document.getElementById('calculator-window');
            if (calc.style.display === 'none') {
                calc.style.display = 'block';
                calc.style.left = '50px';
                calc.style.top = '100px';
            } else {
                calc.style.display = 'none';
            }
        }

        function updateCalcDisplay() {
            document.getElementById('calc-display').textContent = calcValue;
        }

        function calcInput(val) {
            if (calcValue === '0' && !isNaN(val)) {
                calcValue = val;
            } else {
                calcValue += val;
            }
            updateCalcDisplay();
        }

        function calcClear() {
            calcValue = '0';
            updateCalcDisplay();
        }

        function calcBackspace() {
            calcValue = calcValue.slice(0, -1) || '0';
            updateCalcDisplay();
        }

        function calcEquals() {
            try {
                calcValue = String(eval(calcValue));
                if (calcValue === 'Infinity' || calcValue === 'NaN') {
                    calcValue = 'Error';
                }
            } catch (e) {
                calcValue = 'Error';
            }
            updateCalcDisplay();
        }

        // ============ PUZZLE ============
        let puzzleTiles = [];

        function initPuzzle() {
            puzzleTiles = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 0];
            renderPuzzle();
        }

        function renderPuzzle() {
            const grid = document.getElementById('puzzle-grid');
            grid.innerHTML = '';
            puzzleTiles.forEach(function(tile, index) {
                const div = document.createElement('div');
                div.className = 'puzzle-tile' + (tile === 0 ? ' empty' : '');
                div.textContent = tile === 0 ? '' : tile;
                if (tile !== 0) {
                    div.onclick = function() { moveTile(index); };
                }
                grid.appendChild(div);
            });
        }

        function moveTile(index) {
            const emptyIndex = puzzleTiles.indexOf(0);
            const validMoves = [index - 1, index + 1, index - 4, index + 4];

            // Check if move is valid (adjacent to empty)
            if (validMoves.includes(emptyIndex)) {
                // Check not wrapping around edges
                if ((index % 4 === 0 && emptyIndex === index - 1) ||
                    (index % 4 === 3 && emptyIndex === index + 1)) {
                    return;
                }
                // Swap
                puzzleTiles[emptyIndex] = puzzleTiles[index];
                puzzleTiles[index] = 0;
                renderPuzzle();
                checkPuzzleWin();
            }
        }

        function shufflePuzzle() {
            // Perform random valid moves
            for (let i = 0; i < 100; i++) {
                const emptyIndex = puzzleTiles.indexOf(0);
                const moves = [];
                if (emptyIndex >= 4) moves.push(emptyIndex - 4);
                if (emptyIndex < 12) moves.push(emptyIndex + 4);
                if (emptyIndex % 4 !== 0) moves.push(emptyIndex - 1);
                if (emptyIndex % 4 !== 3) moves.push(emptyIndex + 1);
                const randomMove = moves[Math.floor(Math.random() * moves.length)];
                puzzleTiles[emptyIndex] = puzzleTiles[randomMove];
                puzzleTiles[randomMove] = 0;
            }
            renderPuzzle();
        }

        function checkPuzzleWin() {
            const winning = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 0];
            if (puzzleTiles.every((tile, i) => tile === winning[i])) {
                setTimeout(function() {
                    showModal('puzzle-win-modal');
                }, 300);
            }
        }

        function togglePuzzle() {
            const puzzle = document.getElementById('puzzle-window');
            if (puzzle.style.display === 'none') {
                puzzle.style.display = 'block';
                puzzle.style.left = '100px';
                puzzle.style.top = '80px';
                if (puzzleTiles.length === 0) {
                    initPuzzle();
                    shufflePuzzle();
                }
            } else {
                puzzle.style.display = 'none';
            }
        }

        // ============ NOTE PAD ============
        let notepadPages = ['', '', '', '', '', '', '', ''];
        let currentNotePage = 0;

        function toggleNotePad() {
            const notepad = document.getElementById('notepad-window');
            if (notepad.style.display === 'none') {
                notepad.style.display = 'block';
                notepad.style.left = '150px';
                notepad.style.top = '120px';
                loadNotepadFromStorage();
                updateNotepadDisplay();
            } else {
                saveCurrentNotePage();
                notepad.style.display = 'none';
            }
        }

        function saveCurrentNotePage() {
            notepadPages[currentNotePage] = document.getElementById('notepad-textarea').value;
            localStorage.setItem('notepadPages', JSON.stringify(notepadPages));
        }

        function loadNotepadFromStorage() {
            const saved = localStorage.getItem('notepadPages');
            if (saved) {
                notepadPages = JSON.parse(saved);
            }
        }

        function updateNotepadDisplay() {
            document.getElementById('notepad-textarea').value = notepadPages[currentNotePage];
            document.getElementById('notepad-page-num').textContent = currentNotePage + 1;
        }

        function nextNotePage() {
            saveCurrentNotePage();
            currentNotePage = (currentNotePage + 1) % notepadPages.length;
            updateNotepadDisplay();
        }

        // Auto-save on input
        document.getElementById('notepad-textarea').addEventListener('input', function() {
            notepadPages[currentNotePage] = this.value;
            localStorage.setItem('notepadPages', JSON.stringify(notepadPages));
        });

        // ============ EASTER EGGS ============
        const konamiCode = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'KeyB', 'KeyA'];
        let konamiIndex = 0;

        document.addEventListener('keydown', function(e) {
            // Konami code
            if (e.code === konamiCode[konamiIndex]) {
                konamiIndex++;
                if (konamiIndex === konamiCode.length) {
                    showModal('konami-modal');
                    konamiIndex = 0;
                }
            } else {
                konamiIndex = 0;
            }

            // Secret bomb trigger: Ctrl+Shift+B
            if (e.ctrlKey && e.shiftKey && e.code === 'KeyB') {
                showModal('bomb-modal');
            }

            // Sad Mac trigger: Ctrl+Shift+S
            if (e.ctrlKey && e.shiftKey && e.code === 'KeyS') {
                e.preventDefault();
                document.getElementById('sad-mac-screen').classList.add('visible');
            }
        });

        // ============ CLICK OUTSIDE TO CLOSE MODALS ============
        document.querySelectorAll('.modal-overlay').forEach(function(overlay) {
            overlay.addEventListener('click', function(e) {
                if (e.target === overlay) {
                    overlay.classList.remove('visible');
                }
            });
        });

        // ============ DESKTOP ICON SELECTION & DRAGGING ============
        const GRID_SIZE = 80;
        const GRID_PADDING = 10;

        function snapToGrid(value) {
            return Math.round((value - GRID_PADDING) / GRID_SIZE) * GRID_SIZE + GRID_PADDING;
        }

        document.querySelectorAll('.desktop-icon').forEach(function(icon) {
            let isDragging = false;
            let hasMoved = false;
            let startX, startY, iconStartX, iconStartY;
            let clickTimeout;

            icon.addEventListener('mousedown', function(e) {
                if (e.button !== 0) return;
                e.preventDefault();

                // Capture position from bounding rect BEFORE modifying styles
                const rect = icon.getBoundingClientRect();
                const gridRect = document.getElementById('desktop-grid').getBoundingClientRect();
                const leftPos = rect.left - gridRect.left;
                const topPos = rect.top - gridRect.top;

                isDragging = true;
                hasMoved = false;
                icon.classList.add('dragging');

                startX = e.clientX;
                startY = e.clientY;
                iconStartX = leftPos;
                iconStartY = topPos;

                // Convert to left/top positioning
                icon.style.left = leftPos + 'px';
                icon.style.top = topPos + 'px';
                icon.style.right = '';
                icon.style.bottom = '';
            });

            icon.addEventListener('click', function(e) {
                if (hasMoved) {
                    e.preventDefault();
                    e.stopPropagation();
                    return;
                }
                document.querySelectorAll('.desktop-icon').forEach(i => i.classList.remove('selected'));
                this.classList.add('selected');
            });

            document.addEventListener('mousemove', function(e) {
                if (!isDragging) return;

                const deltaX = e.clientX - startX;
                const deltaY = e.clientY - startY;

                if (Math.abs(deltaX) > 5 || Math.abs(deltaY) > 5) {
                    hasMoved = true;
                }

                const gridRect = document.getElementById('desktop-grid').getBoundingClientRect();
                let newX = iconStartX + deltaX;
                let newY = iconStartY + deltaY;

                // Constrain to grid bounds
                newX = Math.max(GRID_PADDING, Math.min(newX, gridRect.width - GRID_SIZE - GRID_PADDING));
                newY = Math.max(GRID_PADDING, Math.min(newY, gridRect.height - GRID_SIZE - GRID_PADDING));

                icon.style.left = newX + 'px';
                icon.style.top = newY + 'px';
            });

            document.addEventListener('mouseup', function(e) {
                if (!isDragging) return;
                isDragging = false;
                icon.classList.remove('dragging');

                if (hasMoved) {
                    // Snap to grid
                    const gridRect = document.getElementById('desktop-grid').getBoundingClientRect();
                    let currentX = parseFloat(icon.style.left);
                    let currentY = parseFloat(icon.style.top);

                    icon.style.left = snapToGrid(currentX) + 'px';
                    icon.style.top = snapToGrid(currentY) + 'px';
                }
            });

            // Touch support for mobile
            icon.addEventListener('touchstart', function(e) {
                const touch = e.touches[0];
                isDragging = true;
                hasMoved = false;
                icon.classList.add('dragging');

                const rect = icon.getBoundingClientRect();
                const gridRect = document.getElementById('desktop-grid').getBoundingClientRect();

                startX = touch.clientX;
                startY = touch.clientY;
                iconStartX = rect.left - gridRect.left;
                iconStartY = rect.top - gridRect.top;

                icon.style.left = iconStartX + 'px';
                icon.style.top = iconStartY + 'px';
                icon.style.right = '';
                icon.style.bottom = '';
            }, { passive: true });

            icon.addEventListener('touchmove', function(e) {
                if (!isDragging) return;
                const touch = e.touches[0];

                const deltaX = touch.clientX - startX;
                const deltaY = touch.clientY - startY;

                if (Math.abs(deltaX) > 5 || Math.abs(deltaY) > 5) {
                    hasMoved = true;
                }

                const gridRect = document.getElementById('desktop-grid').getBoundingClientRect();
                let newX = iconStartX + deltaX;
                let newY = iconStartY + deltaY;

                newX = Math.max(GRID_PADDING, Math.min(newX, gridRect.width - GRID_SIZE - GRID_PADDING));
                newY = Math.max(GRID_PADDING, Math.min(newY, gridRect.height - GRID_SIZE - GRID_PADDING));

                icon.style.left = newX + 'px';
                icon.style.top = newY + 'px';
            }, { passive: true });

            icon.addEventListener('touchend', function(e) {
                if (!isDragging) return;
                isDragging = false;
                icon.classList.remove('dragging');

                if (hasMoved) {
                    const gridRect = document.getElementById('desktop-grid').getBoundingClientRect();
                    let currentX = parseFloat(icon.style.left);
                    let currentY = parseFloat(icon.style.top);

                    icon.style.left = snapToGrid(currentX) + 'px';
                    icon.style.top = snapToGrid(currentY) + 'px';
                }
            });
        });

        document.addEventListener('click', function(e) {
            if (!e.target.closest('.desktop-icon')) {
                document.querySelectorAll('.desktop-icon').forEach(i => i.classList.remove('selected'));
            }
        });
    </script>
</body>
</html>
